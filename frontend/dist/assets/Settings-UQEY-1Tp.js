import{_ as P,r as d,c as b,b as U,i as h,e,q as w,h as y,f as l,v as i,F as _,x,m as r}from"./index-BcmoEdYw.js";import{N as V}from"./NavBar-BtXCAw3x.js";const N={class:"settings-container"},S={class:"settings-content"},T={class:"settings-panel"},k={class:"panel-content"},B={class:"setting-group"},C={class:"setting-group"},F={class:"setting-group"},j={class:"setting-group"},q={__name:"Settings",setup(A){x();const m=d({}),n=d({newUsername:"",currentPassword:"",newPassword:"",confirmPassword:""}),g=d(!1),f=async()=>{const{newUsername:a,currentPassword:s,newPassword:t,confirmPassword:v}=n.value,u=a&&a.trim()!=="",c=t&&t.trim()!=="";if(!u&&!c){r.error("请输入要修改的用户名或密码");return}if(u){if(a.length<3){r.error("用户名长度至少为3位");return}if(a.length>20){r.error("用户名长度不能超过20位");return}if(a===m.value.username){r.error("新用户名不能与当前用户名相同");return}}if(c){if(t.length<6){r.error("新密码长度至少为6位");return}if(t!==v){r.error("两次输入的新密码不一致");return}}if(!s){r.error("请输入当前密码以确认修改");return}try{const o=await fetch("/api/account/change",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({new_username:a,current_password:s,new_password:t})}),p=await o.json();if(!o.ok||!p.success)throw new Error(p.message||"密码更新失败");r.success("修改成功"),n.value={newUsername:"",currentPassword:"",newPassword:"",confirmPassword:""},setTimeout(()=>{window.location.reload()},1e3)}catch(o){r.error(o.message||"更新失败")}finally{g.value=!1}};return(a,s)=>(U(),b(_,null,[h(V),e("div",N,[s[10]||(s[10]=e("div",{class:"settings-header"},[e("h1",{class:"page-title"},[e("span",{class:"title-icon"},"⚙️"),w(" 设置 ")]),e("p",{class:"page-description"},"管理您的账户设置和偏好")],-1)),e("div",S,[e("div",T,[e("div",k,[s[9]||(s[9]=e("h2",{class:"panel-title"},[e("span",{class:"panel-icon"},"👤"),w(" 账户设置 ")],-1)),e("form",{onSubmit:y(f,["prevent"]),class:"account-form"},[e("div",B,[s[4]||(s[4]=e("label",{class:"setting-label",for:"newUsername"},"新用户名（留空则不修改）",-1)),l(e("input",{id:"newUsername","onUpdate:modelValue":s[0]||(s[0]=t=>n.value.newUsername=t),type:"text",class:"setting-input",placeholder:"留空则不修改用户名",minlength:"3",maxlength:"20"},null,512),[[i,n.value.newUsername]])]),e("div",C,[s[5]||(s[5]=e("label",{class:"setting-label",for:"currentPassword"},"当前密码",-1)),l(e("input",{id:"currentPassword","onUpdate:modelValue":s[1]||(s[1]=t=>n.value.currentPassword=t),type:"password",class:"setting-input",placeholder:"请输入当前密码以确认修改",required:""},null,512),[[i,n.value.currentPassword]])]),e("div",F,[s[6]||(s[6]=e("label",{class:"setting-label",for:"newPassword"},"新密码（留空则不修改）",-1)),l(e("input",{id:"newPassword","onUpdate:modelValue":s[2]||(s[2]=t=>n.value.newPassword=t),type:"password",class:"setting-input",placeholder:"留空则不修改密码（至少6位）",minlength:"6"},null,512),[[i,n.value.newPassword]])]),e("div",j,[s[7]||(s[7]=e("label",{class:"setting-label",for:"confirmPassword"},"确认新密码",-1)),l(e("input",{id:"confirmPassword","onUpdate:modelValue":s[3]||(s[3]=t=>n.value.confirmPassword=t),type:"password",class:"setting-input",placeholder:"请再次输入新密码"},null,512),[[i,n.value.confirmPassword]])]),s[8]||(s[8]=e("button",{type:"submit",class:"setting-btn accent"},[e("span",null,"保存修改")],-1))],32)])])])])],64))}},O=P(q,[["__scopeId","data-v-d703ad3e"]]);export{O as default};
