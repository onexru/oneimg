import{r as c,o as j,a as O,c as n,b as l,i as W,e as s,d as y,g as k,t as i,n as R,F as M,j as T,h as H}from"./index-BcmoEdYw.js";import{N as J}from"./NavBar-BtXCAw3x.js";const K={class:"home"},q={class:"main-content"},Q={class:"upload-section"},X={key:0,class:"upload-content"},Y={key:1,class:"upload-progress"},Z={class:"progress-bar"},ee={key:0,class:"upload-results"},se={class:"results-grid"},te={key:0,class:"success-item"},ae=["src","alt"],oe={class:"result-info"},ne={class:"filename"},le={class:"file-size"},ie={class:"dimensions"},re={class:"result-actions"},ce=["onClick"],ue=["onClick"],de={key:1,class:"error-item"},ve={class:"error-message"},me={class:"recent-section"},pe={key:0,class:"recent-grid"},ge=["onClick"],fe=["src","alt"],he={class:"recent-info"},_e={class:"recent-filename"},we={class:"recent-date"},ye={key:1,class:"no-images"},ke=["src","alt"],Ce={class:"preview-info"},De={class:"preview-actions"},ze={__name:"Home",setup(be){const p=c(!1),d=c(!1),h=c(0),v=c(0),f=c([]),_=c([]),C=c(null),r=c({show:!1,image:null}),g=c({show:!1,message:"",type:"success"}),x=a=>{a.preventDefault(),p.value=!0},E=a=>{a.preventDefault(),p.value=!0},N=a=>{a.preventDefault(),a.currentTarget.contains(a.relatedTarget)||(p.value=!1)},S=a=>{a.preventDefault(),p.value=!1;const t=Array.from(a.dataTransfer.files).filter(o=>o.type.startsWith("image/"));t.length>0?w(t):m("请拖拽图片文件","error")},P=()=>{d.value||C.value.click()},A=a=>{const e=Array.from(a.target.files);e.length>0&&w(e),a.target.value=""},D=async a=>{const e=a.clipboardData.items,t=[];for(let o of e)if(o.type.startsWith("image/")){const u=o.getAsFile();if(u){const L=new Date().getTime(),V=o.type.split("/")[1]||"png",U=new File([u],`paste-${L}.${V}`,{type:o.type});t.push(U)}}t.length>0&&(a.preventDefault(),w(t),m(`从剪贴板粘贴了 ${t.length} 个图片`,"success"))},w=async a=>{if(d.value)return;d.value=!0,h.value=a.length,v.value=0,f.value=[];const e=new FormData;a.forEach(t=>{e.append("images[]",t)});try{const t=setInterval(()=>{v.value<90&&(v.value+=Math.random()*10)},200),o=await fetch("/api/upload/images",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:e});clearInterval(t),v.value=100;const u=await o.json();if(o.ok)f.value=u.data,m(u.message,"success"),await b();else throw new Error(u.message||"上传失败")}catch(t){console.error("上传错误:",t),m("上传失败: "+t.message,"error")}finally{d.value=!1,h.value=0,v.value=0}},b=async()=>{try{const a=await fetch("/api/images?limit=12",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(a.ok){const e=await a.json();_.value=e.data.images||[]}}catch(a){console.error("加载图片失败:",a)}},F=a=>{if(!a)return"0 B";const e=1024,t=["B","KB","MB","GB"],o=Math.floor(Math.log(a)/Math.log(e));return parseFloat((a/Math.pow(e,o)).toFixed(2))+" "+t[o]},I=a=>a?new Date(a).toLocaleString("zh-CN"):"",z=async a=>{try{const e=window.location.origin+a;await navigator.clipboard.writeText(e),m("链接已复制到剪贴板","success")}catch{const t=document.createElement("textarea");t.value=window.location.origin+a,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),m("链接已复制到剪贴板","success")}},B=a=>{r.value={show:!0,image:a}},$=()=>{r.value.show=!1},G=a=>{const e=document.createElement("a");e.href=a.url,e.download=a.filename,document.body.appendChild(e),e.click(),document.body.removeChild(e)},m=(a,e="success")=>{g.value={show:!0,message:a,type:e},setTimeout(()=>{g.value.show=!1},3e3)};return j(()=>{document.addEventListener("paste",D),b()}),O(()=>{document.removeEventListener("paste",D)}),(a,e)=>(l(),n("div",K,[W(J),s("div",q,[s("div",Q,[e[7]||(e[7]=s("h2",{class:"section-title"},"图片上传",-1)),s("div",{class:k(["upload-area",{"drag-over":p.value,uploading:d.value}]),onDrop:S,onDragover:x,onDragenter:E,onDragleave:N,onClick:P},[d.value?(l(),n("div",Y,[e[4]||(e[4]=s("div",{class:"spinner"},null,-1)),s("p",null,"正在上传 "+i(h.value)+" 个文件...",1),s("div",Z,[s("div",{class:"progress-fill",style:R({width:v.value+"%"})},null,4)])])):(l(),n("div",X,[...e[3]||(e[3]=[s("div",{class:"upload-icon"},"📁",-1),s("h3",null,"拖拽图片到此处上传",-1),s("p",null,"或者点击选择文件",-1),s("p",{class:"paste-tip"},"💡 提示：您也可以直接按 Ctrl+V 粘贴剪贴板中的图片",-1),s("div",{class:"supported-formats"}," 支持格式：JPG, PNG, GIF, WebP, SVG ",-1)])]))],34),s("input",{ref_key:"fileInput",ref:C,type:"file",multiple:"",accept:"image/*",onChange:A,style:{display:"none"}},null,544),f.value.length>0?(l(),n("div",ee,[e[6]||(e[6]=s("h3",null,"上传结果",-1)),s("div",se,[(l(!0),n(M,null,T(f.value,(t,o)=>(l(),n("div",{key:o,class:k(["result-item",{success:t.success,error:!t.success}])},[t.success?(l(),n("div",te,[s("img",{src:t.url,alt:t.filename,class:"result-image"},null,8,ae),s("div",oe,[s("p",ne,i(t.filename),1),s("p",le,i(F(t.file_size)),1),s("p",ie,i(t.width)+" × "+i(t.height),1),s("div",re,[s("button",{onClick:u=>z(t.url),class:"copy-btn"},"复制链接",8,ce),s("button",{onClick:u=>B(t),class:"preview-btn"},"预览",8,ue)])])])):(l(),n("div",de,[e[5]||(e[5]=s("div",{class:"error-icon"},"❌",-1)),s("p",ve,i(t.message),1)]))],2))),128))])])):y("",!0)]),s("div",me,[e[9]||(e[9]=s("h2",{class:"section-title"},"最近上传",-1)),_.value.length>0?(l(),n("div",pe,[(l(!0),n(M,null,T(_.value,t=>(l(),n("div",{key:t.id,class:"recent-item",onClick:o=>B(t)},[s("img",{src:t.url,alt:t.filename,class:"recent-image"},null,8,fe),s("div",he,[s("p",_e,i(t.filename),1),s("p",we,i(I(t.created_at)),1)])],8,ge))),128))])):(l(),n("div",ye,[...e[8]||(e[8]=[s("p",null,"暂无上传的图片",-1)])]))])]),r.value.show?(l(),n("div",{key:0,class:"preview-modal",onClick:$},[s("div",{class:"preview-content",onClick:e[2]||(e[2]=H(()=>{},["stop"]))},[s("button",{class:"close-btn",onClick:$},"×"),s("img",{src:r.value.image.url,alt:r.value.image.filename,class:"preview-img"},null,8,ke),s("div",Ce,[s("h3",null,i(r.value.image.filename),1),s("p",null,"尺寸: "+i(r.value.image.width)+" × "+i(r.value.image.height),1),s("p",null,"大小: "+i(F(r.value.image.file_size)),1),s("p",null,"上传时间: "+i(I(r.value.image.created_at)),1),s("div",De,[s("button",{onClick:e[0]||(e[0]=t=>z(r.value.image.url)),class:"copy-btn"},"复制链接"),s("button",{onClick:e[1]||(e[1]=t=>G(r.value.image)),class:"download-btn"},"下载")])])])])):y("",!0),g.value.show?(l(),n("div",{key:1,class:k(["notification",g.value.type])},i(g.value.message),3)):y("",!0)]))}};export{ze as default};
