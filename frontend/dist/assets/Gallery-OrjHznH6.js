import{_ as F,r,k as H,o as R,c as i,b as c,i as G,e as t,d as N,f as T,v as J,l as A,g as f,F as Z,j as D,p as Q,q as m,s as O,u as K,t as l,h as k}from"./index-BcmoEdYw.js";import{N as q}from"./NavBar-BtXCAw3x.js";const X={class:"gallery"},Y={class:"gallery-content"},ee={class:"gallery-header"},te={class:"gallery-controls"},se={class:"search-box"},oe={class:"filter-controls"},le={class:"view-controls"},ae={key:0,class:"loading-container"},ne={key:1,class:"images-container"},ie={key:0,class:"images-grid"},ce=["onClick"],re={class:"image-wrapper"},de=["src","alt"],ue={class:"image-overlay"},ve={class:"overlay-actions"},me=["onClick"],pe=["onClick"],he=["onClick"],ge={class:"image-info"},be={class:"image-filename"},_e={class:"image-meta"},we={class:"image-date"},fe={key:1,class:"images-list"},ke={class:"col-thumbnail"},Ce=["src","alt","onClick"],ye={class:"col-filename"},Ie={class:"filename-text"},Me={class:"col-size"},$e={class:"col-dimensions"},xe={class:"col-date"},ze={class:"col-actions"},Be=["onClick"],Se=["onClick"],Pe=["onClick"],Ne={key:2,class:"pagination"},Te=["disabled"],Ze={class:"page-numbers"},De=["onClick"],Ve=["disabled"],Ee={key:2,class:"empty-state"},Ge=["src","alt"],Ae={class:"preview-info"},We={class:"preview-details"},je={class:"preview-actions"},Le={__name:"Gallery",setup(Ue){const _=r([]),C=r(!1),w=r(""),y=r("created_at"),I=r("desc"),p=r("grid"),d=r(1),h=r(1),W=r(20),a=r({show:!1,image:null}),g=r({show:!1,message:"",type:"success"}),j=H(()=>{const o=[],e=Math.max(1,d.value-2),n=Math.min(h.value,d.value+2);for(let s=e;s<=n;s++)o.push(s);return o}),v=async()=>{C.value=!0;try{const o=new URLSearchParams({page:d.value,limit:W.value,sort_by:y.value,sort_order:I.value});w.value&&o.append("search",w.value);const e=await fetch(`/api/images?${o}`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(e.ok){const n=await e.json();_.value=n.data.images||[],h.value=n.data.total_pages||1}else throw new Error("加载图片失败")}catch(o){console.error("加载图片错误:",o),b("加载图片失败: "+o.message,"error")}finally{C.value=!1}};let V=null;const L=()=>{clearTimeout(V),V=setTimeout(()=>{d.value=1,v()},500)},M=o=>{o>=1&&o<=h.value&&(d.value=o,v(),window.scrollTo({top:0,behavior:"smooth"}))},E=o=>{a.value={show:!0,image:o}},$=()=>{a.value.show=!1},x=async o=>{try{const e=window.location.origin+o;await navigator.clipboard.writeText(e),b("链接已复制到剪贴板","success")}catch{const n=document.createElement("textarea");n.value=window.location.origin+o,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),b("链接已复制到剪贴板","success")}},z=o=>{const e=document.createElement("a");e.href=o.url,e.download=o.filename,document.body.appendChild(e),e.click(),document.body.removeChild(e)},B=async o=>{if(confirm(`确定要删除图片 "${o.filename}" 吗？`))try{const e=await fetch(`/api/images/${o.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(e.ok)b("图片删除成功","success"),a.value.show&&a.value.image.id===o.id&&$(),v();else{const n=await e.json();throw new Error(n.message||"删除失败")}}catch(e){console.error("删除图片错误:",e),b("删除图片失败: "+e.message,"error")}},U=o=>{o.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPuWbvueJh+WKoOi9veWksei0pTwvdGV4dD48L3N2Zz4="},S=o=>{if(!o)return"0 B";const e=1024,n=["B","KB","MB","GB"],s=Math.floor(Math.log(o)/Math.log(e));return parseFloat((o/Math.pow(e,s)).toFixed(2))+" "+n[s]},P=o=>o?new Date(o).toLocaleString("zh-CN"):"",b=(o,e="success")=>{g.value={show:!0,message:o,type:e},setTimeout(()=>{g.value.show=!1},3e3)};return R(()=>{v()}),(o,e)=>{const n=K("router-link");return c(),i("div",X,[G(q),t("div",Y,[t("div",ee,[e[14]||(e[14]=t("h1",{class:"gallery-title"},"图片画廊",-1)),t("div",te,[t("div",se,[T(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>w.value=s),type:"text",placeholder:"搜索图片...",class:"search-input",onInput:L},null,544),[[J,w.value]]),e[11]||(e[11]=t("span",{class:"search-icon"},"🔍",-1))]),t("div",oe,[T(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>y.value=s),onChange:v,class:"sort-select"},[...e[12]||(e[12]=[t("option",{value:"created_at"},"按时间排序",-1),t("option",{value:"file_size"},"按大小排序",-1),t("option",{value:"filename"},"按名称排序",-1)])],544),[[A,y.value]]),T(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>I.value=s),onChange:v,class:"sort-select"},[...e[13]||(e[13]=[t("option",{value:"desc"},"降序",-1),t("option",{value:"asc"},"升序",-1)])],544),[[A,I.value]])]),t("div",le,[t("button",{onClick:e[3]||(e[3]=s=>p.value="grid"),class:f([{active:p.value==="grid"},"view-btn"])}," ⊞ 网格 ",2),t("button",{onClick:e[4]||(e[4]=s=>p.value="list"),class:f([{active:p.value==="list"},"view-btn"])}," ☰ 列表 ",2)])])]),C.value?(c(),i("div",ae,[...e[15]||(e[15]=[t("div",{class:"spinner"},null,-1),t("p",null,"加载中...",-1)])])):_.value.length>0?(c(),i("div",ne,[p.value==="grid"?(c(),i("div",ie,[(c(!0),i(Z,null,D(_.value,s=>(c(),i("div",{key:s.id,class:"image-card",onClick:u=>E(s)},[t("div",re,[t("img",{src:s.url,alt:s.filename,class:"image-thumbnail",onError:U},null,40,de),t("div",ue,[t("div",ve,[t("button",{onClick:k(u=>x(s.url),["stop"]),class:"action-btn copy-btn"}," 📋 ",8,me),t("button",{onClick:k(u=>z(s),["stop"]),class:"action-btn download-btn"}," ⬇️ ",8,pe),t("button",{onClick:k(u=>B(s),["stop"]),class:"action-btn delete-btn"}," 🗑️ ",8,he)])])]),t("div",ge,[t("p",be,l(s.filename),1),t("p",_e,l(S(s.file_size))+" • "+l(s.width)+"×"+l(s.height),1),t("p",we,l(P(s.created_at)),1)])],8,ce))),128))])):(c(),i("div",fe,[e[16]||(e[16]=Q('<div class="list-header" data-v-4b0274a9><div class="col-thumbnail" data-v-4b0274a9>预览</div><div class="col-filename" data-v-4b0274a9>文件名</div><div class="col-size" data-v-4b0274a9>大小</div><div class="col-dimensions" data-v-4b0274a9>尺寸</div><div class="col-date" data-v-4b0274a9>上传时间</div><div class="col-actions" data-v-4b0274a9>操作</div></div>',1)),(c(!0),i(Z,null,D(_.value,s=>(c(),i("div",{key:s.id,class:"list-item"},[t("div",ke,[t("img",{src:s.url,alt:s.filename,class:"list-thumbnail",onClick:u=>E(s)},null,8,Ce)]),t("div",ye,[t("span",Ie,l(s.filename),1)]),t("div",Me,l(S(s.file_size)),1),t("div",$e,l(s.width)+"×"+l(s.height),1),t("div",xe,l(P(s.created_at)),1),t("div",ze,[t("button",{onClick:u=>x(s.url),class:"list-action-btn",title:"复制链接"}," 📋 ",8,Be),t("button",{onClick:u=>z(s),class:"list-action-btn",title:"下载"}," ⬇️ ",8,Se),t("button",{onClick:u=>B(s),class:"list-action-btn delete",title:"删除"}," 🗑️ ",8,Pe)])]))),128))])),h.value>1?(c(),i("div",Ne,[t("button",{onClick:e[5]||(e[5]=s=>M(d.value-1)),disabled:d.value<=1,class:"page-btn"}," ← 上一页 ",8,Te),t("div",Ze,[(c(!0),i(Z,null,D(j.value,s=>(c(),i("button",{key:s,onClick:u=>M(s),class:f([{active:s===d.value},"page-number"])},l(s),11,De))),128))]),t("button",{onClick:e[6]||(e[6]=s=>M(d.value+1)),disabled:d.value>=h.value,class:"page-btn"}," 下一页 → ",8,Ve)])):N("",!0)])):(c(),i("div",Ee,[e[19]||(e[19]=t("div",{class:"empty-icon"},"📷",-1)),e[20]||(e[20]=t("h3",null,"暂无图片",-1)),t("p",null,[e[18]||(e[18]=m("还没有上传任何图片，",-1)),G(n,{to:"/"},{default:O(()=>[...e[17]||(e[17]=[m("去上传一些吧",-1)])]),_:1})])]))]),a.value.show?(c(),i("div",{key:0,class:"preview-modal",onClick:$},[t("div",{class:"preview-content",onClick:e[10]||(e[10]=k(()=>{},["stop"]))},[t("button",{class:"close-btn",onClick:$},"×"),t("img",{src:a.value.image.url,alt:a.value.image.filename,class:"preview-image"},null,8,Ge),t("div",Ae,[t("h3",null,l(a.value.image.filename),1),t("div",We,[t("p",null,[e[21]||(e[21]=t("strong",null,"尺寸:",-1)),m(" "+l(a.value.image.width)+" × "+l(a.value.image.height),1)]),t("p",null,[e[22]||(e[22]=t("strong",null,"大小:",-1)),m(" "+l(S(a.value.image.file_size)),1)]),t("p",null,[e[23]||(e[23]=t("strong",null,"类型:",-1)),m(" "+l(a.value.image.mime_type),1)]),t("p",null,[e[24]||(e[24]=t("strong",null,"上传时间:",-1)),m(" "+l(P(a.value.image.created_at)),1)])]),t("div",je,[t("button",{onClick:e[7]||(e[7]=s=>x(a.value.image.url)),class:"preview-action-btn"}," 📋 复制链接 "),t("button",{onClick:e[8]||(e[8]=s=>z(a.value.image)),class:"preview-action-btn"}," ⬇️ 下载 "),t("button",{onClick:e[9]||(e[9]=s=>B(a.value.image)),class:"preview-action-btn delete"}," 🗑️ 删除 ")])])])])):N("",!0),g.value.show?(c(),i("div",{key:1,class:f(["notification",g.value.type])},l(g.value.message),3)):N("",!0)])}}},Re=F(Le,[["__scopeId","data-v-4b0274a9"]]);export{Re as default};
